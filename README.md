# 项目介绍
huayumall是一款分布式电商项目,用户可以在线购物，浏览商品等。。
该项目的管理系统是基于人人开源来完成的,包括CRUD等功能也是基于人人开源来完成的
# 技术架构
Java8 spring-boot spring-cloud mySQL Mybatis-plus Redis ElasticSearch RabbitMQ 
# 项目难点
  问题一：查询商品时,分别远程调用其他服务查询该商品的详细信息时,发现耗时巨大
    原因：远程查询时会造成当前线程等待远程查询的线程完成才进行下一步,而一旦调用多个远程服务,则耗时累加
    解决思路：远程调用时,可以开个异步线程,这样在调用其他服务时,当前线程无需等待其他线程的执行
    解决：使用Java的CompletableFuture+自定义线程池来完成远程服务的调用
  
  问题二：用户在查看一个商品详情时,刚好该商品的缓存失效了，而此时拥有大量用户查询该商品,此时会有大量请求访问数据库,造成数据库宕机
    解决思路：可以在查询商品详细的主方法加锁,只放一个用户到数据库查询商品,在缓存到redis中,而其他被阻塞的线程在来打该方法前先查询缓存
    解决：该项目是分布式,为保证高可用,采用了集群的模式,为了能锁住,采用redisson来进行分布式锁,在调用查询商品时发现缓存没有数据了,在查询数据库的方法前加把lock锁
          只放一个线程进行查询数据库,查到数据后在放到缓存中,而为了防止大量请求阻塞,可以在查询数据库的方法前在查询缓存,这样大量对阻塞的线程都会在阻塞前查询缓存
          
  问题三：在高并发下对数据库数据进行修改时,发现缓存没有进行修改
    原因：删除缓存,在修改数据时,发现a线程删除了缓存,修改数据还没完成,b线程因为缓存里没有数据,来到了数据库查询数据,再把数据放到缓存里,造成的数据的不一致
    解决：使用双删,在修改数据时,删除缓存,修改数据,再删除缓存
    
  问题四：在提交订单时刷新页面后再次点击下单操作,发现订单一直重复创建
    解决思路：给当前订单加个防重token,后台也存储一份token,只要点击了下单,那么就根据token进行比较,成功后再删除token
    解决：在订单页面加个token,后台也存储一份,只要用户点击了下单,就可以根据页面提交的token跟服务器的进行比较,再删除服务器的token
            然而在高并发情况下发现token有时会乱删,所以应该保证查询token和删除是一致性的,这里我使用redis的ula脚本来完成
  
